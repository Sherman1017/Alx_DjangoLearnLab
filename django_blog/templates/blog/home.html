{% extends 'base.html' %}

{% block title %}Blog Posts{% endblock %}

{% block content %}
<h1 class="mb-4">Blog Posts</h1>

<!-- Search Info -->
{% if query %}
<div class="alert alert-info mb-4">
    <h5>Search Results for: "{{ query }}"</h5>
    <p class="mb-0">{{ posts.count }} post{{ posts.count|pluralize }} found</p>
</div>
{% endif %}

<!-- Tag Cloud -->
{% if all_tags %}
<div class="tag-cloud mb-4">
    <h5>Browse by Tags:</h5>
    {% for tag in all_tags %}
        <a href="{% url 'posts_by_tag' tag_name=tag.name %}" class="tag">
            {{ tag.name }}
        </a>
    {% endfor %}
</div>
{% endif %}

<!-- Posts List -->
{% for post in posts %}
<div class="post">
    <h2>{{ post.title }}</h2>
    <p class="text-muted">
        By {{ post.author }} on {{ post.created_at|date:"F d, Y" }}
    </p>
    
    <!-- Tags -->
    {% if post.tags.all %}
    <div class="mb-3">
        <strong>Tags:</strong>
        {% for tag in post.tags.all %}
            <a href="{% url 'posts_by_tag' tag_name=tag.name %}" class="tag">
                {{ tag.name }}
            </a>
        {% endfor %}
    </div>
    {% endif %}
    
    <p>{{ post.content|truncatewords:50 }}</p>
    <div class="d-flex gap-2">
        <a href="{% url 'post_detail' pk=post.pk %}" class="btn btn-primary">
            Read More & View Comments
        </a>
        {% if user == post.author %}
        <a href="{% url 'post_edit' pk=post.pk %}" class="btn btn-outline-secondary">Edit</a>
        {% endif %}
    </div>
</div>
{% empty %}
<div class="alert alert-info">
    <h4>No posts found!</h4>
    {% if query %}
        <p>No posts match your search for "{{ query }}".</p>
    {% else %}
        <p>Check back later for new blog posts.</p>
    {% endif %}
</div>
{% endfor %}

<!-- Quick Stats -->
<div class="card mt-4">
    <div class="card-body">
        <h5 class="card-title">Blog Stats</h5>
        <ul class="mb-0">
            <li>Total Posts: {{ posts.count }}</li>
            <li>Total Tags: {{ all_tags.count }}</li>
            <li>Search URL: <code>/search/?q=your_search_term</code></li>
            <li>Tag URL: <code>/tags/&lt;tag_name&gt;/</code></li>
        </ul>
    </div>
</div>
{% endblock %}
